<!DOCTYPE html>
<html lang="en">
<head>
  <!--<link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>-->

    <link rel="stylesheet" type="text/css" href="https://rokpovsic.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://rokpovsic.com/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://rokpovsic.com/theme/font-awesome/css/font-awesome.min.css">

  <!--<style>-->
    <!--body {-->
      <!--font-family: 'Arima Madurai', sans-serif;-->
    <!--}-->
  <!--</style>-->


    <link href="https://rokpovsic.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Rok Povšič blog Atom">



  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


    <meta name="author" content="Rok Povšič" />
    <meta name="description" content="" />
<meta property="og:site_name" content="Rok Povšič blog"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Rok Povšič blog"/>
<meta property="og:description" content=""/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://rokpovsic.com"/>

  <title>Rok Povšič blog</title>
</head>
<body>
  <aside>
    <div>
      <a href="https://rokpovsic.com">
        <img src="https://rokpovsic.com/theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href="https://rokpovsic.com"></a></h1>
      <nav>
        <ul class="list">
          <li><a href="https://rokpovsic.com/pages/about-me.html#about-me">About me</a></li>
          <li><a href="https://rokpovsic.com/pages/contact.html#contact">Contact</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/rokpovsic" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://github.com/rok-povsic" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>

      <h3>RECENT POSTS</h3>
          <p>
            <a href="https://rokpovsic.com/what-is-the-chance-of-losing-money-at-the-stock-market.html#what-is-the-chance-of-losing-money-at-the-stock-market">What is the chance of losing money at the stock market?</a>
          </p>
          <p>
            <a href="https://rokpovsic.com/a-short-guide-for-new-vim-users.html#a-short-guide-for-new-vim-users">A short guide for new VIM users</a>
          </p>
          <p>
            <a href="https://rokpovsic.com/keyboard-tricks-to-write-code-faster.html#keyboard-tricks-to-write-code-faster">Keyboard tricks to write code faster</a>
          </p>
          <p>
            <a href="https://rokpovsic.com/using-pycharm-without-a-mouse.html#using-pycharm-without-a-mouse">Using PyCharm without a mouse</a>
          </p>
          <p>
            <a href="https://rokpovsic.com/how-to-fix-mouse-offset-bug-in-vmware-workstation-under-windows-81-host.html#how-to-fix-mouse-offset-bug-in-vmware-workstation-under-windows-81-host">How to fix mouse offset bug in VMWare Workstation under Windows 8.1 host</a>
          </p>
          <p>
            <a href="https://rokpovsic.com/c-why-its-better-to-have-short-lived-datacontext.html#c-why-its-better-to-have-short-lived-datacontext">[C#] Why it’s better to have short-lived DataContext</a>
          </p>
    </div>
  </aside>
  <main>
    <nav>
      <a href="https://rokpovsic.com">Home</a>
      <!---->
      <!--<a href="/pages/about-me">About</a>-->
      <!---->
      <!--<a href="/pages/contact">Contact</a>-->
      <!---->
      <a href="https://rokpovsic.com/pages/about-me.html#about-me">About me</a>
      <a href="https://rokpovsic.com/pages/contact.html#contact">Contact</a>
      <a href="https://rokpovsic.com/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h2><a href="https://rokpovsic.com/what-is-the-chance-of-losing-money-at-the-stock-market.html#what-is-the-chance-of-losing-money-at-the-stock-market">What is the chance of losing money at the stock market?</a></h2>
    <p>
      Posted on Mon 23 January 2017 in <a href="https://rokpovsic.com/category/finance.html">finance</a>
      &#8226; Tagged with
      <a href="https://rokpovsic.com/tag/investing.html">investing</a>,      <a href="https://rokpovsic.com/tag/savings.html">savings</a>,      <a href="https://rokpovsic.com/tag/money.html">money</a>    </p>
  </header>
  <div>
      <p>What is the percentage chance of loosing money at the stock market? Well, that
surely depends on the investment style and is hard to quantify. If you hold a small number of companies
in the portfolio, the chance of losing money is greater because if any single company performs badly,
the effect on the portfolio will be large.</p>
<p>But say you invest in a large number of companies, say in the companies of some stock index.
We cannot be certain of any performance of the selected companies in the future.
What we can do is we can look at how the stock market index performed in the past.</p>
<p>To do this, I wanted to have as large amount of data as possible.
The most data I could find, is for a stock index
<a href="https://en.wikipedia.org/wiki/Dow_Jones_Industrial_Average">DJIA</a>.
The index consists of 30 large companies from the United States and I have data from July 1896 onwards.
It is a good-enough heuristics of how the stock market moves.</p>
<p>Let's say you invested your money into the 30 companies of the DJIA index at some random point after year 1896. What's the chance your return
after some number of years is positive or negative?</p>
<p>Well, that depends a lot on how long you are invested. The common wisdom says investing in the stock market should be done for a long term.
Let's look at the data.</p>
<p><img alt="DJIA chance of losing money" src="https://rokpovsic.com/images/lose_money_chance/djia_losing_chance.png" /></p>
<p>How about investing in gold? Below is the chance of losing money in gold, when invested for X years.</p>
<p>I have gold price data only from 1968 onwards so the maximum displayed number of years in position is 20.</p>
<p><img alt="Gold chance of losing money" src="https://rokpovsic.com/images/lose_money_chance/gold_losing_chance.png" /></p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://rokpovsic.com/a-short-guide-for-new-vim-users.html#a-short-guide-for-new-vim-users">A short guide for new VIM users</a></h2>
    <p>
      Posted on Sat 10 December 2016 in <a href="https://rokpovsic.com/category/vim.html">vim</a>
      &#8226; Tagged with
      <a href="https://rokpovsic.com/tag/vim.html">vim</a>    </p>
  </header>
  <div>
      <p>VIM is a text editor that makes writing code MUCH more enjoyable. After using it for a long time it's almost hard to believe how people can write code without it. It's like driving a new BMW opposed to an old Peugeot. Everything is just smooth and fast. And unlike BMW, it's free! Watching another programmer write code without using VIM is <em>almost</em> like watching someone type using two fingers (one with each hand). You just want to say: give me the keyboard, I'll do it for you. The programmer uses UP, DOWN, LEFT and RIGHT keys, reaches for the mouse a lot, repeats certain actions a lot and is most likely very efficient and clever with the use of HOME, END, PGUP and PGDOWN keys. But compared to VIM it's all slow and awkward.</p>
<p>The best thing about VIM is that you don't even need to use the original program! You just install a VIM plugin for your favorite editor (such plugin exists for all major editors, including Visual Studio, all JetBrains editors, Atom, Sublime, ...) and you get all the functionality of the original VIM editor. What's great here is that using VIM gives you a consistency across all the editors. You don't need to remember as much specific stuff for each editor (i.e. what's the shortcut for Redo in this IDE, again?) - VIM is the same in all of them.</p>
<h2>Modes</h2>
<p>When writing code (or some other text) in a regular editor the key, the keys you press appear on the screen right away. Using VIM this will happen only if you are in so called <em>insert</em> mode. When in this mode, VIM behaves as any other editor. After VIM has just started, it is in <em>normal</em> mode. If you simply want to write some text, press <strong>i</strong> to enter <em>insert</em> mode. Now you can type anything you want. To exit <em>insert</em> mode and go back to <em>normal</em> mode, press <strong>ESC</strong>.</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/modes.gif" /></p>
<h2>Moving around</h2>
<p>So why would is this <em>normal</em> mode even needed if we use keyboard to type characters on the screen and the only way we can do that is by being in the <em>insert</em> mode. Well, VIM makes the keyboard much more versatile tool. For example, when in <em>normal</em> mode, you can use keys <strong>H</strong>, <strong>J</strong>, <strong>K</strong> and <strong>L</strong> in order to move LEFT, DOWN, UP and RIGHT, respectively. That's very useful since it removes the need to always move your hand to the arrow keys. It takes some time to get used to but once you know it, it's hard to go back. When the hands are in the typing position (left index finger on <strong>F</strong> and right index finger on <strong>J</strong>) it's much more convenient to simply press <strong>ESC</strong> (which I even virtually switched with <strong>CAPS LOCK</strong> to have it closer to the standard position) and use <strong>H</strong>, <strong>J</strong>, <strong>K</strong> and <strong>L</strong>.</p>
<p>Moving to the start of the next word is done by pressing <strong>W</strong> and moving to the start of previous word by pressing <strong>B</strong>. It's similar to pressing <strong>CTRL + LEFT/RIGHT</strong> when using regular editor, without the need to move right hand away from natural position and pressing two keys at the same time.</p>
<p>Another thing I use a lot is pressing <strong>{</strong> and <strong>}</strong> which will jump the cursor to previous and to next paragraph (in <strong>normal</strong> mode of course) and pressing <strong>0</strong> and <strong>$$</strong> which move the cursor to the beginning or end of the line you are currently on.</p>
<p>I think that this alone is worth using VIM when writing code or anything else.</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/hjkl.gif" /></p>
<h2>Copying, deleting and pasting lines</h2>
<p>When writing code it's common to copy a line and paste it somewhere else. Copying a line is done by pressing <strong>YY</strong> (i.e. pressing <strong>Y</strong> twice). After that you can move anywhere else and with pressing <strong>P</strong> the line will be pasted under the line your cursor is on.</p>
<p>Deleting a line is done by pressing <strong>DD</strong>. We can imagine it's similar to cutting a line as you can still paste it using <strong>P</strong>.</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/copy_paste.gif" /></p>
<h2>Undo / Redo</h2>
<p>Undoing the last command (i.e. inserting, deleting, pasting, etc.) is done by pressing <strong>U</strong>. The redo command is <strong>CTRL + R</strong>.</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/undo.gif" /></p>
<h2>Selecting lines</h2>
<p>Another very useful command is <strong>SHIFT + V</strong> which starts to select lines. After moving up or down (preferably with <strong>K</strong> or <strong>J</strong>) you press <strong>Y</strong> to copy them. Now you can move to some other place and press <strong>P</strong> to paste copied lines (use <strong>D</strong> instead of <strong>Y</strong> to delete them).</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/selecting.gif" /></p>
<h2>Saving positions and jumping</h2>
<p>Wherever your cursor is located you can press <strong>M</strong> followed by any character an the position will be saved. After that you can press <strong>'</strong> followed by the character you used previously and your cursor will jump to saved position. Very useful!</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/save.gif" /></p>
<h2>Searching</h2>
<p>Searching is done by simply pressing <strong>/</strong>, typing the word to search for and pressing <strong>ENTER</strong>. The cursor is moved to the first found word. After that, pressing <strong>N</strong> will move the cursor to the next found word (and <strong>SHIFT + N</strong> will move it to the previous found word).</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/searching.gif" /></p>
<h2>Replacing</h2>
<p>Often you need to replace all words with some other words in a given text. First, you select the text (by using <strong>SHIFT + V</strong>, remember?) and then typing this (without the &lt; and &gt;): <strong>:s/&lt;text to search&gt;/&lt;text to replace it with&gt;/g</strong>. It might sound complex but once you get used to it it's so much faster and easier than using the default Find &amp; Replace functionality of whatever IDE you are using at this moment.</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/replacing.gif" /></p>
<h2>Other small things</h2>
<p>Pressing <strong>SHIFT + I</strong> will open <em>insert</em> mode in the beginning of the row and <strong>SHIFT + A</strong> will open <em>insert</em> mode at the end of the row.</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/other.gif" /></p>
<h2>Repeating commands machine</h2>
<p>Repeating commands is where VIM really shows its power. Whatever command you've seen so far, you can save its execution sequence and repeat it. This is huge! First you record a command or a sequence of commands by first pressing <strong>Q&lt;some key, say A&gt;</strong>, executing the commands, and then pressing <strong>Q</strong> to end the execution and save it. Then you can replay it by pressing <strong>&lt;number of times to repeat&gt;@a</strong>.</p>
<p>Let's look at an example. Say I have these lines in my editor and I want to add parenthesis around them, with a comma on the right and a tab on the left.</p>
<p>Marlon Brando
Al Pacino
James Caan
Richard S. Castellano
Robert Duvall
Sterling Hayden</p>
<p>I could do it by hand or I could utilize the great power of VIM and do it singlehandedly, wizard-style. I'll do it by first moving to the first line and pressing <strong>QA</strong> - that will start recording my commands under the key A. Then I do <strong>SHIFT + I</strong> to move to the beginning of the line and open <em>normal</em> mode, followed by pressing TAB and ". Then I press <strong>ESC</strong> to exit <em>insert</em> mode and return to <em>normal</em> mode and do <strong>SHIFT + A</strong> to open <em>insert</em> mode at the end of the line. Next, I press " and ,. I exit <em>insert</em> mode again and press <strong>J</strong> to move one line down. My execution sequence is finished so I complete it by pressing <strong>Q</strong>.</p>
<p>Now VIM has remember the whole execution and will execute it any number of times. I simply do <strong>5@A</strong> and the execution will be repeated 5 times, fixing all my lines.</p>
<p><img alt="" src="https://rokpovsic.com/images/vim_short/repeating.gif" /></p>
<h2>How to learn all this?</h2>
<p>There's no need to learn everything to start using VIM. I think that VIM has major advantages even when you use only a small subset of the provided functionality. Simply start using it by installing a VIM plugin for your code editor and using mostly <em>insert</em> mode and maybe <strong>H</strong>, <strong>J</strong>, <strong>K</strong> and <strong>L</strong> (the keys to move in different directions, remember?) in the <em>normal</em> mode instead of the arrow keys. After you get a grasp of that, add some other thing that sounds interesting. It's like driving a car - at first it's hard and complex, after a few months it's completely automatic and you don't even think about it.</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://rokpovsic.com/keyboard-tricks-to-write-code-faster.html#keyboard-tricks-to-write-code-faster">Keyboard tricks to write code faster</a></h2>
    <p>
      Posted on Mon 31 October 2016 in <a href="https://rokpovsic.com/category/typing.html">typing</a>
      &#8226; Tagged with
      <a href="https://rokpovsic.com/tag/typing.html">typing</a>,      <a href="https://rokpovsic.com/tag/fast.html">fast</a>    </p>
  </header>
  <div>
      <h2>Using English keyboard layout</h2>
<p>Using any keyboard layout other than English may be less optimal for programming, at least that was my experience when compared to using Slovenian and German keyboard layouts to write code. Switching to the English layout made a great difference for me. It's simply faster to reach commonly used characters such as []{};:,@""&lt;&gt;= compared some (maybe all) other layouts. I've trained myself to always use English keyboard when programming and when writing in English language in general (such as now).  </p>
<p>When writing in Slovenian language I switch the keyboard layout to Slovenian and continue seamlessly as nothing changed. Then only keys that I sometimes use wrong on Slovenian layout are letters Y and Z which are for some reason switched in Slovenian keyboard layout.</p>
<h2>Try using VIM</h2>
<p>The next level mastery is not only to stop reaching for a mouse but also stop reaching for the movement keys (UP, DOWN, LEFT and RIGHT). They are also quite far away from the keys you use to do the actual writing. When programming we use movement keys a lot and minimizing or entirely removing the need to access them saves time and thousands of unnecessary hand movements.</p>
<h2>Switch Caps Lock and Esc keys</h2>
<p>Since I press Esc much more than Caps Lock, I switched the two keys (functionally, not physically). I use software called <a href="https://sharpkeys.codeplex.com/">SharpKeys</a> to do that. It's much more enjoyable to use the keyboard like that.</p>
<p>I also considered switching Backspace with some other key but haven't so far found a good replacement. I thought about Right Shift, which I don't use a lot, but it's not that of a good improvement. </p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://rokpovsic.com/using-pycharm-without-a-mouse.html#using-pycharm-without-a-mouse">Using PyCharm without a mouse</a></h2>
    <p>
      Posted on Sat 29 October 2016 in <a href="https://rokpovsic.com/category/pycharm.html">pycharm</a>
      &#8226; Tagged with
      <a href="https://rokpovsic.com/tag/pycharm.html">pycharm</a>,      <a href="https://rokpovsic.com/tag/shortcuts.html">shortcuts</a>    </p>
  </header>
  <div>
      <p>I've been always fan of minimizing mouse/touchpad usage when programming. There is a certain kind of satisfaction when you are able to do everything with the keyboard. You get the feeling of being agile, swift. It's a sign of mastery. There's no unnecessary movement and unnecessary time and muscle power spent. Watching another programmer use their keyboard solely and be fast doing it makes you respect them more. Watching them grab the mouse a lot and wait for them to find the mouse cursor is sometimes even a little painful.</p>
<h2>Run the program</h2>
<p>So how do you go about using keyboard more and using mouse less? Well, start off by learning how to run your program with only the keyboard.</p>
<p>How to do that? To run currently open file press <strong>CTRL + SHIFT + F10</strong>. To run lastly open file, even if you are currently in another file, press <strong>SHIFT + F10</strong>. To run an arbitrarily chosen file press <strong>SHIFT + ALT + F10</strong> to open a dialog box where you select which file to run.</p>
<h4>Hide output window</h4>
<p>After you run the program output window will appear if it wasn't shown before. Unlike in Visual Studio, this output window will not hide automatically. This can be annoying if you want a large screen space for code. Well, there's a simple shortcut for hiding a window you are in (besides grabbing the mouse and clicking hide window button on top right) and it's <strong>SHIFT + ESC</strong>. Press that after running the program and output window will close leaving your focus in the code and you can start typing again.</p>
<h2>Go to a file</h2>
<p>Press <strong>CTRL + SHIFT + N</strong> and start writing name of a file to jump to it. I've remapped the shortcut to  <strong>CTRL + T</strong> to be equal to the same shortcut in ReSharper (Visual Studio).</p>
<h2>Refactoring</h2>
<p>The best advantage of PyCharm is its refactoring capability. Being positioned on a variable/function/class and doing <strong>CTRL + SHIFT + ALT + T</strong>. It gives you lots of refactoring options such as:</p>
<ul>
<li>rename,</li>
<li>inline,</li>
<li>extract variable, method,</li>
<li>change method signature.</li>
</ul>
<p>These PyCharm refactoring functionalities are not only huge time savers but also, unlike we humans, they don't make mistakes.</p>
<p>Since this shortcut involves four keys, I've remapped it to <strong>CTRL + SHIFT + R</strong> (same as refactoring using ReSharper in Visual Studio).</p>
<h4>Confirm refactoring</h4>
<p>When refactoring, PyCharm sometimes requires a confirmation of the refactoring (e.g. after renaming a function). The button you have to click says "Do Refactor" and it's located in another window. This used to annoy me a lot since I didn't know how to press this button via keyboard. But I found the solution. After doing the renaming, simply press <strong>ALT + D</strong> and the "Do Refactor" button will be clicked. After that press <strong>SHIFT + ESC</strong> to close the refactoring window.</p>
<h2>Toggle full screen</h2>
<p>You can add your own shortcut to toggle full screen if you go to Settings -&gt; Keymap (shorcut to doing that is pressing <strong>CTRL + ALT + S</strong> and typing <strong>Keymap</strong>) since there is no default shortcut.</p>
<p>But you can still do it with your keyboard pretty fast by pressing <strong>ALT + V</strong> to open the View menu and pressing <strong>up arrow</strong> and <strong>Enter</strong>.</p>
<p>I got used to that even though it's not the completely fastest way although it's pretty fast.</p>
<h2>You can't do everything with a keyboard</h2>
<p>I don't use solely keyboard for every single thing in PyCharm. I still use the mouse to scroll up and down in the output window. I use the mouse to open a file for which I am not exactly sure what its name is but I know where it's located in the folder hierarchy. My goal is not to never use the mouse but to not use it when there's a fast and comfortable alternative. There is a lot of these kinds of shortcuts and they keep surprising you if you look for them.</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://rokpovsic.com/how-to-fix-mouse-offset-bug-in-vmware-workstation-under-windows-81-host.html#how-to-fix-mouse-offset-bug-in-vmware-workstation-under-windows-81-host">How to fix mouse offset bug in VMWare Workstation under Windows 8.1 host</a></h2>
    <p>
      Posted on Fri 12 February 2016 in <a href="https://rokpovsic.com/category/vmware.html">vmware</a>
      &#8226; Tagged with
      <a href="https://rokpovsic.com/tag/vmware.html">vmware</a>,      <a href="https://rokpovsic.com/tag/bug.html">bug</a>    </p>
  </header>
  <div>
      <p>There’s a bug in mouse behavior that happened to me in VMWare Workstation under Windows 8.1 host with Ubuntu 14.04 as client. When hovering mouse over something and/or selecting something by dragging, the mouse moved it’s position by some offset. See the GIF below.</p>
<p><img alt="VMWare bug" src="https://rokpovsic.com/images/vmware_bug.gif" /></p>
<p><strong>How to fix it?</strong></p>
<ul>
<li>Locate VMWare Workstation, right click and open Properties.</li>
<li>Under Compatibility check Disable display scaling on high DPI settings.</li>
<li>Restart VMWare Workstation.</li>
</ul>
<p>The mouse should now behave normally.</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://rokpovsic.com/c-why-its-better-to-have-short-lived-datacontext.html#c-why-its-better-to-have-short-lived-datacontext">[C#] Why it’s better to have short-lived DataContext</a></h2>
    <p>
      Posted on Wed 20 August 2014 in <a href="https://rokpovsic.com/category/c.html">C#</a>
      &#8226; Tagged with
      <a href="https://rokpovsic.com/tag/c.html">c#</a>,      <a href="https://rokpovsic.com/tag/datacontext.html">datacontext</a>    </p>
  </header>
  <div>
      <p>When you work with SQL databases in your C# application, one way is to use LINQ to SQL framework. 
The way to use LINQ to SQL is to create an instance of DataContext for your specific database and use it to retrieve, insert, update and delete data.</p>
<p>If the project is not too large, you could have all your dealings with database abstracted 
in one class. That puts all your database logic in one place. You also can 
easily mock this class (as opposed to mocking DataContext). Let’s call this DatabaseOperations.</p>
<p>When having a class which contains methods that do work the database, two ways of dealing with DataContext come to mind.</p>
<div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">DatabaseOperations</span> <span class="p">:</span> <span class="n">IDatabaseOperations</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">MyDatabaseDataContext</span> <span class="n">_context</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">DatabaseOperations</span><span class="p">(</span><span class="n">MyDatabaseDataContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_context</span> <span class="p">=</span> <span class="n">context</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetUsers</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Retrieve users by using _context.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Role</span><span class="p">&gt;</span> <span class="n">GetRoles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Retrieve roles by using _context.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Group</span><span class="p">&gt;</span> <span class="n">GetGroups</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Retrieve groups by using _context.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Another way would be without the context instance as a field. Here each method creates and closes its own context. Sample code:</p>
<div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">DatabaseOperations</span> <span class="p">:</span> <span class="n">IDatabaseOperations</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">_connectionString</span> <span class="p">=</span> <span class="s">&quot;myConnStr&quot;</span><span class="p">;</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetUsers</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyDatabaseDataContext</span><span class="p">(</span><span class="n">_connectionString</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// Retrieve users by using context.</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Role</span><span class="p">&gt;</span> <span class="n">GetRoles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyDatabaseDataContext</span><span class="p">(</span><span class="n">_connectionString</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// Retrieve roles by using context.</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Group</span><span class="p">&gt;</span> <span class="n">GetGroups</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyDatabaseDataContext</span><span class="p">(</span><span class="n">_connectionString</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// Retrieve groups by using context.</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>At first, the second approach may seem to be more wasteful as each function has to create the context. That creates some amount of duplicated code. However, there are two reasons why this second approach is preferred.</p>
<p>The first reason is that in the first example the instance of a class DatabaseOperations can live a long time. You probably do not create new instance of the class each time you call function inside. Long lived DatabaseOperations instance means also that the injected DataContext lives long time. The DataContext, however, is supposed to be used on only small units of work. The reason is that in the first example, one instance of DataContext has to track the changes that happen in returned objects.</p>
<p>More info in the <a href="http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext(v=vs.110).aspx">official documentation</a>:</p>
<blockquote>
<p>In general, a DataContext instance is designed to last for one “unit of work” however your application defines that term. A DataContext is lightweight and is not expensive to create. A typical LINQ to SQL application creates DataContext instances at method scope or as a member of short-lived classes that represent a logical set of related database operations.</p>
</blockquote>
<p>The second reason, which is important from the design point of view, is that in first example, DataContext has to be passed in via constructor. However, the DatabaseOperations class behaves like a Service Object and in order to use dependency injection, Service Objects should take as constructor parameters only other Service Objects. DataContext is more of a Value Object which does not belong in the parameter list. The tree of Service Objects cannot be created at the start of the program.</p>
<p>For more info see <a href="http://misko.hevery.com/2008/09/30/to-new-or-not-to-new/">this blog article</a> by Miško Hevery (who is the author of JavaScript framework AngularJS).</p>
<p>You could, of course, also have DataContext as a parameter in every function. That would allow your class to be a Service Object which has no Value Objects in the constructor parameter list. However, the first reason would still be violated if that DataContext is long-lived or, as the documentation says, used for more than one “unit of work”.</p>
<p>In order to somehow mitigate the duplication of code by creating a new DataContext in every method, you might be able to use the trick from <a href="http://stackoverflow.com/a/23367569/365837">this StackOverflow answer</a>.</p>
<p>That might or might not be useful for you, depending on where you store and how you obtain the connection string. For example, if you have it stored as a static class field, then it is appropriate. If you have to get the connection string from a file or another database, then it might get a bit complicated (in my last project, I decided against it and just used the simple approach shown in the second example).</p>
  </div>
</article>

  <div class="pagination">
  </div>

    <footer>
        <p>&copy; Rok Povšič </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Rok Povšič blog ",
  "url" : "https://rokpovsic.com",
  "image": "",
  "description": ""
}
</script>
</body>
</html>